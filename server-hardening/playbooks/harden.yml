- name: Harden Debian 13 Servers
  hosts: all
  become: true
  gather_facts: true

  pre_tasks:
    - name: Verify target system is Debian 13
      assert:
        that:
          - ansible_distribution == "Debian"
          - (ansible_distribution_major_version | string) == "13"
        fail_msg: "This playbook only supports Debian 13. Detected: {{ ansible_distribution }} {{ ansible_distribution_version }}"
        success_msg: "Target system verified: Debian 13"
      tags: always

    - name: Verify Python interpreter availability
      assert:
        that:
          - ansible_python.executable is defined
        fail_msg: "Python interpreter not found on target system"
        success_msg: "Python interpreter available: {{ ansible_python.executable }}"
      tags: always

  roles:
    - installed_packages
    - automatic_updates
    - time_sync
    - filesystem
    - firewall
    - ssh
    - fail2ban
    - network
    - audit_logging
