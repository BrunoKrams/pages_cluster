---
- name: Ensure systemd-timesyncd is installed
  ansible.builtin.apt:
    name: systemd-timesyncd
    state: present
    update_cache: false

- name: Configure systemd-timesyncd
  ansible.builtin.template:
    src: timesyncd.conf.j2
    dest: /etc/systemd/timesyncd.conf
    owner: root
    group: root
    mode: '0644'
  notify: Restart timesyncd

- name: Ensure systemd-timesyncd is enabled and started
  ansible.builtin.systemd_service:
    name: systemd-timesyncd
    enabled: true
    state: started

- name: Check time synchronization status
  ansible.builtin.command: timedatectl show-timesync --all
  register: timesync_status
  changed_when: false

- name: Display time sync status
  ansible.builtin.debug:
    msg: "Time synchronization: {{ timesync_status.stdout_lines }}"
